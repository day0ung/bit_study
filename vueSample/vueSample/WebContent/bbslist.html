<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<script src="http://netdna.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>   

<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="https://unpkg.com/vue-router"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script src="./jquery/jquery.twbsPagination.js"></script>
<script src="./jquery/jquery.twbsPagination.min.js"></script>
</head>
<body>
<!-- 게시판목록+검색+페이징(plugin) -->

<div id="app" class="container">
	<table class="table table-striped table-hover">
	<thead>
		<tr>
		 <th>번호</th>
		 <th>제목</th>
		 <th>작성자</th>
		</tr>
	</thead>
	
	<tbody v-for="(data, index) in dataList">
	<tr>
		<td>{{index +1}}</td><!-- data.num -->
		<td @click="detail(data.seq)">{{data.title}}</td>
		<td>{{data.id}}</td>
	</tr>
	</tbody>
	</table>
	
	<!-- paging -->
	<div class="row d-flex justify-content-center">
		<nav aria-label="Page navigation example" style="text-align: center;">
			<ul class="pagination-sm" id="pagination"></ul>
		</nav>	
	</div>
	
	<div align="center">
	<!-- 검색선택 -->
	<select v-model="s_category">				<!-- option하나하나에 들어가게됨 -->
		<option v-for="option in options" v-bind:value="option.value"> <!-- option에 value값을 넣어라하고 for문돌린거임 -->
			{{ option.text }}
		</option>
	</select>
	<!-- 검색창 -->
	<input v-model="s_keyword" placeholder="검색어 입력" size="20">
	
	<!-- 검색버튼  //click - 함수 ()있얻되고 없어도됨-->
	<button v-on:click="searchBbs()">검색</button>
	<br><br>
	<button v-on:click="writeBbs">글 추가</button>
	</div>
</div>

<script type="text/javascript">
 	//변수 vu를 잡는이유 : 외부에서 접근하기 위해 = 페이징처리하려고
 	var vu = new Vue({
		el:'#app',
		data:{
			dataList: [], //axios를 통해 다시 받을 것임
			s_category: 'sel',
			s_keyword: '',
			options:[
				{ text:'선택', value:'sel' },
				{ text:'제목', value:'title' },
				{ text:'내용', value:'content' },
				{ text:'작성자', value:'writer' }
			]
		},
 		mounted:function (){  // mounted 맨처음에 장면이 바뀔때 자동적으로 호출되는 함수 
 			//alert('mounted'); //==initialized 같은것
			this.getList();
 		},
 		methods:{
			getList:function(){
				//글의 총수
	 			axios.get('http://localhost:3000/getBbsCount', 
	 					{
	 						params:{
	 							s_category:'',
	 							s_keyword:'',
	 							recordCountPerPage:10,
	 							pageNumber: 1
	 						}
	 					}
	 			).then(res => {
	 				//alert('getBbsCount통신성공');
	 				//alert(res.data);
	 				loadPage(res.data);
	 			})
	 			
	 			//글목록
	 			axios.get('http://localhost:3000/getBbsPageList', 
	 				{
	 				params:{
							s_category:'',
							s_keyword:'',
							recordCountPerPage:10,
							pageNumber: 1
						}	 				
	 				}
	 			).then(res =>{
	 				//alert("통신성공");
	 				//alert(JSON.stringify(res.data)); //문자열로 바꾸는 확인용
	 				this.dataList = res.data; //dataList에 집어넣기
	 			})
			},searchBbs:function(){
				//alert(this.s_category);
				//alert(this.s_keyword);
				
				if(this.s_category =='seq'){
					alert('카테고리를 선택해주세요');
					this.getList();
					return;
				}else if(this.s_keyword == ""){
					alert('검색어를 입력해주세요');
				}
				
				//글의 총수
	 			axios.get('http://localhost:3000/getBbsCount', 
	 					{
	 						params:{
	 							s_category:this.s_category,
	 							s_keyword:this.s_keyword,
	 							recordCountPerPage:10,
	 							pageNumber: 1
	 						}
	 					}
	 			).then(res => {
	 				loadPage(res.data);
	 			})
	 			
	 			//목록 가져오기
	 			axios.get('http://localhost:3000/getBbsPageList', 
	 				{
	 				params:{
	 					s_category:this.s_category,
							s_keyword:this.s_keyword,
							recordCountPerPage:10,
							pageNumber: 1
						}	 				
	 				}
	 			).then(res =>{
	 				this.dataList = res.data; //dataList에 집어넣기
	 			})
				
				
			},writeBbs:function(){
				//이동
				location.href = "writeBbs.html";
			},detail:function(seq){
				//이동
				location.href= "detailBbs.html?seq="+seq;
			}
 		}
 	});
 	
 function loadPage(totalCount){
 		var pageSize = 10;
 		var pageNumber = 1;
 		var recordCountPerPage = 10; //한페이지당 최대 보여줄 글의 수 

 		var totalPages = totalCount/pageSize;
 		if (totalCount%pageSize > 0) {
 			totalPages++;
 		}
 		
 		//페이지를 지웠다가 다시 뿌리고 해야함 검색하고나서 리프레시 해야하기 때문에
 		$('#pagination').twbsPagination('destroy'); // 페이지 갱신
 		
 		$('#pagination').twbsPagination({
 		   /*startPage: 1,	//시작 페이지 */
 		   totalPages: totalPages,  // 전체 page블럭 수
 		   visiblePages: 10,  // 출력될 page 블럭수 상수로 지정해 줘도 되고, 변수로 지정해줘도 된다.
 		   first: '<span aria-hidden="true">«</span>',
 		   prev: "이전",
 		   next: "다음",   
 		   last: '<span aria-hidden="true">»</span>',
 		   onPageClick: function (event, page) {  //페이지 번호를 클릭했을 때
 			  // alert("page:" + page);
 				//$('#page-content').text('Page ' + page);	
 				
 				//데이터 불러오기
 				axios.get('http://localhost:3000/getBbsPageList',{
 					params:{
 						s_category: vu.s_category, //외부에서 쓰는 함수 이기 때문에 this가 아니라 vu.으로 value를가져와야함
						s_keyword: vu.s_keyword,
						recordCountPerPage:10,
						pageNumber: page
 						}
 					})
 					.then(res =>{
 						vu.dataList = res.data;	
 					}
 				)
 		   }
 		});

 	}
 	
</script>
</body>
</html>